<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.0.0-beta.1 for Hugo"><meta name=author content="Theo Sanderson"><meta name=description content="In the last post I introduced neural networks, generative adversarial networks (GANs) and InfoGANs.
In this post I’ll describe the motivation and strategy for creating a GAN which generates images of biological cells, like this:"><link rel=alternate hreflang=en-us href=/blog/2018/10/02/adventures-with-infogans-towards-generative-models-of-biological-images-part-2/><link rel=preconnect href=https://fonts.gstatic.com crossorigin><meta name=theme-color content="#1565c0"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous media=print onload="this.media='all'"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload="this.media='all'"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload="this.media='all'" disabled><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin=anonymous media=print onload="this.media='all'"><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.2.2/lazysizes.min.js integrity="sha512-TmDwFLhg3UA4ZG0Eb4MIyT1O1Mb+Oww5kFG0uHqXsdbyZz9DcvYQhKpGgNkamAI6h2lGGZq2X8ftOJvF/XjTUg==" crossorigin=anonymous async></script><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload="this.media='all'"><link rel=stylesheet href=/css/wowchemy.a2dda909fb8228e17412d06b4423e0a6.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-65298-19"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
function trackOutboundLink(url,target){gtag('event','click',{'event_category':'outbound','event_label':url,'transport_type':'beacon','event_callback':function(){if(target!=='_blank'){document.location=url;}}});console.debug("Outbound link clicked: "+url);}
function onClickCallback(event){if((event.target.tagName!=='A')||(event.target.host===window.location.host)){return;}
trackOutboundLink(event.target,event.target.getAttribute('target'));}
gtag('js',new Date());gtag('config','UA-65298-19',{});document.addEventListener('click',onClickCallback,false);</script><link rel=manifest href=/index.webmanifest><link rel=icon type=image/png href=/images/icon_hu141e5746c4390abcaff97a6bd8371d9c_4466_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=/images/icon_hu141e5746c4390abcaff97a6bd8371d9c_4466_192x192_fill_lanczos_center_2.png><link rel=canonical href=/blog/2018/10/02/adventures-with-infogans-towards-generative-models-of-biological-images-part-2/><meta property="twitter:card" content="summary"><meta property="twitter:site" content="@theosanderson"><meta property="twitter:creator" content="@theosanderson"><meta property="og:site_name" content="Theo Sanderson"><meta property="og:url" content="/blog/2018/10/02/adventures-with-infogans-towards-generative-models-of-biological-images-part-2/"><meta property="og:title" content="Adventures with InfoGANs: towards generative models of biological images (part 2) | Theo Sanderson"><meta property="og:description" content="In the last post I introduced neural networks, generative adversarial networks (GANs) and InfoGANs.
In this post I’ll describe the motivation and strategy for creating a GAN which generates images of biological cells, like this:"><meta property="og:image" content="/images/icon_hu141e5746c4390abcaff97a6bd8371d9c_4466_512x512_fill_lanczos_center_2.png"><meta property="twitter:image" content="/images/icon_hu141e5746c4390abcaff97a6bd8371d9c_4466_512x512_fill_lanczos_center_2.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2018-10-02T10:05:06+00:00"><meta property="article:modified_time" content="2018-10-02T10:05:06+00:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/blog/2018/10/02/adventures-with-infogans-towards-generative-models-of-biological-images-part-2/"},"headline":"Adventures with InfoGANs: towards generative models of biological images (part 2)","datePublished":"2018-10-02T10:05:06Z","dateModified":"2018-10-02T10:05:06Z","author":{"@type":"Person","name":"Theo Sanderson"},"publisher":{"@type":"Organization","name":"Theo Sanderson","logo":{"@type":"ImageObject","url":"/images/icon_hu141e5746c4390abcaff97a6bd8371d9c_4466_192x192_fill_lanczos_center_2.png"}},"description":"\u003cp\u003eIn \u003ca href=\"http://theo.io/blog/2018/10/02/adventures-with-infogans-towards-generative-models-of-biological-images/\" target=\"_blank\" rel=\"noopener\"\u003ethe last post\u003c/a\u003e I introduced neural networks, generative adversarial networks (GANs) and InfoGANs.\u003c/p\u003e\n\u003cp\u003eIn this post I’ll describe the motivation and strategy for creating a GAN which generates images of biological cells, like this:\u003c/p\u003e"}</script><title>Adventures with InfoGANs: towards generative models of biological images (part 2) | Theo Sanderson</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper><script src=/js/wowchemy-init.min.7264cf0eba3b66951b36da7d2cecf9c5.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class=page-header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Theo Sanderson</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Theo Sanderson</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#featured><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#contact><span>Contact</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>Adventures with InfoGANs: towards generative models of biological images (part 2)</h1><div class=article-metadata><span class=article-date>Oct 2, 2018</span>
<span class=middot-divider></span><span class=article-categories><i class="fas fa-folder mr-1"></i><a href=/category/ml/>ML</a></span></div></div><link rel=stylesheet href=/theo.css><div class=article-container><div class=article-style><a class=viewsource href=https://github.com/theosanderson/theo.io/tree/master/content/post/archive_posts/2018-10-02-adventures-with-infogans-towards-generative-models-of-biological-images-part-2.md>View source</a><p>In <a href=http://theo.io/blog/2018/10/02/adventures-with-infogans-towards-generative-models-of-biological-images/ target=_blank rel=noopener>the last post</a> I introduced neural networks, generative adversarial networks (GANs) and InfoGANs.</p><p>In this post I’ll describe the motivation and strategy for creating a GAN which generates images of biological cells, like this:</p><p><strong>Motivation</strong><br>Two microscopic of cells from an identical cell-line are never going to be pixel-for-pixel identical, yet they still share key similarities in terms of morphology. One way to get a computer to demonstrate it “understands” these morphological properties is to force it to create images of new cells. When a model is capable of generating any image that might be taken of a specific cell one might argue that it has gained some knowledge about the cell.</p><p>This is an appealing approach as it is is easy to acquire large numbers of static images of cells, for instance by using an imaging flow cytometer. This device flows cells past a camera and acquires thousands of images each second, each with a large number of fluorescent channels. These are static images of course, but if they come from an synchronous population they should contain representatives of every stage in the cell cycle. If our generative model was sufficiently capable of truly understanding the structure in the data (and there is <a href=https://twitter.com/ericjang11/status/1046124500369047553 target=_blank rel=noopener>evidence that such models do</a>) then provided if we could generate a model where one dimension in our generator corresponded to pseudotime we could generate timecourse “videos” from models trained on these single images. This would, apart from anything else, have practical utility, avoiding the problems of photobleaching in imaging.</p><p><strong>What I did</strong></p><p>From my work at the <a href=https://www.sanger.ac.uk/science/groups/rayner-group target=_blank rel=noopener>Rayner lab</a> at the Sanger Institute I have access to a large dataset of images of infected red blood cells acquired with an imaging flow cytometer. These images contain both a brightfield transmitted light channel and a fluorescent channel showing DNA in the parasite. I used some filtering (with a classification network) to isolate only images containing single cells which were fully visible. I then trained an InfoGAN in much the same way as in the digit dataset described in the last post.</p><p>I tried a couple of different versions, one with a large number of “communicated” values – which is what you see above.</p><p>The network learns about quite a few aspects of <em>Plasmodium</em><br>biology, and also some basic optics:</p><ul><li>It learns about red blood cell morphology and to produce images of plausible cells</li><li>It learns that the nucleus in the DAPI channel is always within the bounds of the RBC in the brightfield channel.</li><li>It learns that there are a subset of cells (schizonts) which have both black haemozoin, and widespread, bright DAPI nuclei (often arranged in a circular shape)</li><li>It learns that cells can appear in front of or behind the focal plane and how to render both types.</li><li>I could go on.. the images produced by the network are almost all entirely plausible images that a biologist would be unable to distinguish from true parasites.</li></ul><p>As an aside I really like watching this network cycle between samples, it is strikingly similar to watching a motile cell wriggling:<br><img src=/post/archive_posts/old_wp_images/wp-content/uploads/2018/09/cell_gan.gif alt width=480 height=160 class="alignnone size-full wp-image-215"></p><p>I also trained a <a href=http://theo.io/GAN/plasmodium_gan2/test.html target=_blank rel=noopener>second version</a>, with many fewer communicated variables, which really lets us see what the network sees as the most salient features. Unsurprisingly, these are mostly about the location and orientation of the red blood cell. Interestingly this network makes one of the parameters the focal position of the cell:</p><p><img src=/post/archive_posts/old_wp_images/wp-content/uploads/2018/09/focus.gif alt width=480 height=232 class="alignnone size-full wp-image-216"></p><p>For any cell you look at, one end of this variable produces one type of halo, and the other the opposite, just as if this parameter was controlling the focus of a microscope.</p><p>This property illustrates the sort of property it would be really exciting to get the network to learn. In an ideal world the sliders would represent something like: focus, cell orientation and parasite lifecycle stage. So if you had a young ring stage parasite and you wanted to watch it mature you could just drag the slider across. Or if you wanted to focus on the far side of the cell you could just drag another slider. Such an idea may sound fanciful, but I don’t think it’s too far away.</p><p>There are a number of simple ways I could improve the work I’ve done here. The network has to capture the complete distribution of cellular images presented as “real”. In this case you can see that these are in many different orientations, and different positions in the image. So a vast amount of the networks efoort goes into recapturing that, not very interesting, spatial variation. I made some basic attempts to align the images presented to the network, but this is something I could definitely improve. Something you will see as the cells dance from one space in the network to another is that while the nucleus tends to move smoothly around the black haemozoin will often fade out in one location and appear in another. The lack of smoothness here is an example of “modal collapse” that often haunts GANs, but there are a number of ways to tackle it.</p><p>In short, this work just scratches the surface of what what I suspect is possible with generative models of biological cells.</p><p>In some organisms there are genome-wide fluorescent-tag libraries available. Building a generative model using these (possibly with the need for some pairwise imaging) could allow the creation of a synthetic cell in which every protein can be simultaneously visualised. It’s an exciting prospect, and I think it’s nearer than it seems.</p><p><small>P.S. I belatedly looked for similar published work, and found two <a href=https://www.biorxiv.org/content/early/2017/12/02/227645>cool</a> <a href=https://arxiv.org/pdf/1708.04692.pdf>papers</a>. The second of these introduces a star-shaped network designed to allow alignment in much the way I imagine at the end of this post. And more generally there are a ton of GAN papers applying the technique to super-resolution microscopy, in silico staining, etc.</small></p></div><div class=share-box aria-hidden=true><ul class=share><li><a href="https://twitter.com/intent/tweet?url=/blog/2018/10/02/adventures-with-infogans-towards-generative-models-of-biological-images-part-2/&text=Adventures%20with%20InfoGANs:%20towards%20generative%20models%20of%20biological%20images%20%28part%202%29" target=_blank rel=noopener class=share-btn-twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=/blog/2018/10/02/adventures-with-infogans-towards-generative-models-of-biological-images-part-2/&t=Adventures%20with%20InfoGANs:%20towards%20generative%20models%20of%20biological%20images%20%28part%202%29" target=_blank rel=noopener class=share-btn-facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=Adventures%20with%20InfoGANs:%20towards%20generative%20models%20of%20biological%20images%20%28part%202%29&body=/blog/2018/10/02/adventures-with-infogans-towards-generative-models-of-biological-images-part-2/" target=_blank rel=noopener class=share-btn-email><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=/blog/2018/10/02/adventures-with-infogans-towards-generative-models-of-biological-images-part-2/&title=Adventures%20with%20InfoGANs:%20towards%20generative%20models%20of%20biological%20images%20%28part%202%29" target=_blank rel=noopener class=share-btn-linkedin><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=Adventures%20with%20InfoGANs:%20towards%20generative%20models%20of%20biological%20images%20%28part%202%29%20/blog/2018/10/02/adventures-with-infogans-towards-generative-models-of-biological-images-part-2/" target=_blank rel=noopener class=share-btn-whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=/blog/2018/10/02/adventures-with-infogans-towards-generative-models-of-biological-images-part-2/&title=Adventures%20with%20InfoGANs:%20towards%20generative%20models%20of%20biological%20images%20%28part%202%29" target=_blank rel=noopener class=share-btn-weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><img class="avatar mr-3 avatar-circle" src=/authors/admin/avatar_hu8af67025a90ae4f28f8d45441763eced_96138_270x270_fill_q75_lanczos_center.jpg alt="Theo Sanderson"><div class=media-body><h5 class=card-title>Theo Sanderson</h5><h6 class=card-subtitle>Sir Henry Wellcome Fellow</h6><p class=card-text>Biologist developing tools to scale malaria reverse genetics.</p><ul class=network-icon aria-hidden=true><li><a href=/#contact><i class="fas fa-envelope"></i></a></li><li><a href=https://twitter.com/theosanderson target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a href="https://scholar.google.com/citations?user=voDDwYIAAAAJ" target=_blank rel=noopener><i class="fas fa-graduation-cap"></i></a></li><li><a href=https://github.com/theosanderson target=_blank rel=noopener><i class="fab fa-github"></i></a></li></ul></div></div><div class="article-widget content-widget-hr"><h3>Related</h3><ul><li><a href=/blog/2018/11/13/biggan-interpolations/>BigGAN interpolations</a></li><li><a href=/blog/2018/10/02/adventures-with-infogans-towards-generative-models-of-biological-images/>Adventures with InfoGANs: towards generative models of biological images (part 1)</a></li></ul></div></div></article></div><div class=page-footer><div class=container><footer class=site-footer></footer></div></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin=anonymous></script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
        <div class="search-hit-content">
          <div class="search-hit-name">
            <a href="{{relpermalink}}">{{title}}</a>
            <div class="article-metadata search-hit-type">{{type}}</div>
            <p class="search-hit-description">{{snippet}}</p>
          </div>
        </div>
      </div>
    </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=/en/js/wowchemy.min.297f736e130400781cfee00eff1f1afd.js></script></body></html>